<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Announcement</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor" crossorigin="anonymous">
    <!-- Boxicons CDN Links -->
    <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="add_announcement_style.css">
    <!-- <script type="text/javascript" src="add_ancmnt.js"></script> -->
    <style>
        #lgid {
            justify-items: center;
            margin: 8px;
            margin-top: 0px;
            padding-top: 15px;
        }

        #mainI {
            height: 100%;
            width: 100%;
            opacity: 0.9;
        }

        #mainTx {
            justify-items: center;
            display: flex;
            justify-content: center;
        }
    </style>
</head>

<body>
    <div class="sidebar">
        <div class="logo_content">
            <div class="logo">
                <!-- <i class='bx bxl-c-plus-plus'></i> -->
                <div class="logo_name">
                    <img src="charusat_transparent.png" alt="" style="width:180px; height: 49px;" id="lgid">
                </div>
            </div>
            <i class="bx bx-menu" id="btn"></i>
        </div>
        <ul class="nav_list">
            <li>
                <i class="bx bx-search"></i>
                <input type="text" placeholder="Search...">
                <span class="tooltip"><b>Search...</b></span>
            </li>
            <li>
                <a href="#">
                    <i class="bx bx-grid-alt"></i>
                    <span class="links_name">DashBoard</span>
                </a>
                <span class="tooltip"><b>DashBoard</b></span>
            </li>
            <li>
                <a href="#">
                    <i class="bx bx-cross"></i>
                    <span class="links_name">Create Event</span>
                </a>
                <span class="tooltip"><b>Create Event</b></span>
            </li>
            <li>
                <a href="#">
                    <i class="bx bx-calendar-check"></i>
                    <span class="links_name">SubEvent</span>
                </a>
                <span class="tooltip"><b>Sub Event</b></span>
            </li>
            <li>
                <a href="#">
                    <i class="bx bxs-calendar"></i>
                    <span class="links_name">BatchWise Nomination</span>
                </a>
                <span class="tooltip"><b>Nomination</b></span>
            </li>
            <li>
                <a href="#">
                    <i class="bx bx-certification"></i>
                    <span class="links_name">Certificate</span>
                </a>
                <span class="tooltip"><b>Certificate</b></span>
            </li>
            <li>
                <a href="#">
                    <i class="bx bxs-user-check"></i>
                    <span class="links_name">Attendance</span>
                </a>
                <span class="tooltip"><b>Attendance</b></span>
            </li>
            <li>
                <a href="#">
                    <i class="bx bx-log-out"></i>
                    <span class="links_name">Log Out</span>
                </a>
                <span class="tooltip"><b>Log Out</b></span>
            </li>

        </ul>
        <div class="profile_content">
            <div class="profile">
                <div class="profile_details">
                    <img src="./1.png" alt="">
                    <div class="name_job">
                        <div class="name">Prem Shahi</div>
                        <div class="job">Web Desiner</div>
                    </div>
                </div>
                <i class="bx bx-log-out" id="log_out"></i>
            </div>
        </div>
    </div>
    <div class="home_content">
        <section class="tabs" id="tabs">
            <section id="all_tab">
                <div id="tab" class="tab" onclick="showTab(this.id)">
                    <h4>New Announcement</h4>
                    <div id="close_tab" class="close_tab" onclick="closeTabs(this.id)">
                        <img src="close.png" alt="" class="close">
                    </div>
                </div>
            </section>
            <section class="plus_tab" id="plusbtn" onclick="addTabs()" onc>
                <img src="plus_tab.png" alt="" class="click_plus">
            </section>
        </section>

        <section class="announcement_section" id="announcement_section">
                <form name="form" method="post" id="form" class="form">
                    <div class="form-group row ">
                        <label for="academicyear" class="col-sm-4 col-form-label fieldspace"><strong>Academic
                                Year</strong><span class="required"> *</span></label>
                        <div class="col-sm-5 fieldspace">
                            <select class="form-control" id="academicyear" name="academicyear"
                                onchange="savevalue(this.id)" required>
                                <option value="2021-2022">2021-2022</option>
                                <option value="2022-2023">2022-2023</option>
                                <option value="2023-2024">2023-2024</option>
                                <option value="2024-2025">2024-2025</option>
                                <option value="2025-2026">2025-2026</option>
                                <option value="2026-2027">2026-2027</option>
                                <option value="2027-2028">2027-2028</option>
                                <option value="2028-2029">2028-2029</option>
                                <option value="2029-2030">2029-2030</option>
                            </select>
                        </div><br>

                        <label for="eventname" class="col-sm-4 col-form-label fieldspace"><strong>Event
                                Name</strong><span class="required"> *</span></label>
                        <div class="col-sm-8 fieldspace">
                            <textarea class="form-control" id="eventname" name="eventname"
                                pattern="/^[^. 0-9\?][a-zA-z .]+[0-9. ]*?[^. ]$/gm" rows="3" required></textarea>
                        </div>

                        <label for="eventfocus" class="col-sm-4 col-form-label fieldspace"><strong>Event
                                Focus</strong><span class="required"> *</span></label>
                        <div class="col-sm-8 fieldspace">
                            <textarea class="form-control" id="eventfocus" name="eventfocus"
                                pattern="/^[^. 0-9\?][a-zA-z .]+[0-9. ]*?[^. ]$/gm" rows="3"></textarea>
                        </div>

                        <label for="eventstartdate" class="col-sm-4 col-form-label fieldspace"><strong>Event Start
                                Date</strong><span class="required"> *</span></label>
                        <div class="col-sm-5 fieldspace">
                            <input type="date" class="form-control" id="eventstartdate" name="eventstartdate"
                                onchange="calculateDays()">
                        </div>

                        <label for="eventenddate" class="col-sm-4 col-form-label fieldspace"><strong>Event End
                                Date</strong><span class="required"> *</span></label>
                        <div class="col-sm-5 fieldspace">
                            <input type="date" class="form-control" id="eventenddate" name="eventenddate"
                                onchange="calculateDays()">
                        </div>

                        <div class="form-group row" id="eventtiming">
                        </div>

                        <label for="eventvenue" class="col-sm-4 col-form-label fieldspace"><strong>Event
                                Venue</strong><span class="required"> *</span></label>
                        <div class="col-sm-8 fieldspace">
                            <textarea class="form-control" id="eventvenue" name="eventvenue" rows="3"></textarea>
                        </div>

                        <label for="eventresourceperson" class="col-sm-4 col-form-label fieldspace"><strong>Event
                                Resource Person</strong><span class="required"> *</span></label>
                        <div class="col-sm-8 fieldspace">
                            <textarea class="form-control" id="eventresourceperson" name="eventresourceperson"
                                pattern="/^[^\_\\`~/\*!@#\$%\^&\(\)-=\+\{\}\|\?0-9][A-z .a-z]+[^\_\\`~/\*!@#\$%\^&\(\)-=\+\{\}\| ]$/gm"
                                rows="3"></textarea>
                        </div>

                        <div class="container">
                            <div class="col-md-12 text-center">
                                <button type="submit" class="btn btn-outline-dark fieldspace" id="submit"
                                    name="submit">Announce</button>
                            </div>
                        </div>

                    </div>
                </form>
        </section>
    </div>

    <script>
        let btn = document.querySelector("#btn");
        let sidebar = document.querySelector(".sidebar");
        let searchBtn = document.querySelector(".bx-search");
        let dateInput1 = document.querySelector("#eventstartdate").min = new Date().toISOString().slice(0, 10);
        let dateInput2 = document.querySelector("#eventenddate").min = new Date().toISOString().slice(0, 10);

        let counter = 0;
        let count = 0;
        var tabList = {
            'tab': 'form'
        };
        var tabHistory = {
            'tab': 'form'
        };
        var childs_announcement = document.getElementById('announcement_section').children; // to fetch the forms present inside announcement section

        // to store the data for each tabs form fields
        var tab_info = ['academicyear', 'eventname', 'eventfocus', 'eventstartdate', 'eventenddate', 'eventtiming', 'eventvenue', 'eventresourceperson'];
        var tab1_info = ['academicyear1', 'eventname1', 'eventfocus1', 'eventstartdate1', 'eventenddate1', 'eventtiming1', 'eventvenue1', 'eventresourceperson1'];
        var tab2_info = ['academicyear2', 'eventname2', 'eventfocus2', 'eventstartdate2', 'eventenddate2', 'eventtiming2', 'eventvenue2', 'eventresourceperson2'];
        var tab3_info = ['academicyear3', 'eventname3', 'eventfocus3', 'eventstartdate3', 'eventenddate3', 'eventtiming3', 'eventvenue3', 'eventresourceperson3'];
        var tab4_info = ['academicyear4', 'eventname4', 'eventfocus4', 'eventstartdate4', 'eventenddate4', 'eventtiming4', 'eventvenue4', 'eventresourceperson4'];

        var choose_tab = {
            tab: tab_info,
            tab1: tab1_info,
            tab2: tab2_info,
            tab3: tab3_info,
            tab4: tab4_info,
        }

        // sidebar functions
        btn.onclick = function () {
            sidebar.classList.toggle("active");
        }
        searchBtn.onclick = function () {
            sidebar.classList.toggle("active");
        }

        // tab functions
        function calculateDays() {
            counter++;
            var d1 = document.getElementById("eventstartdate").value;
            var d2 = document.getElementById("eventenddate").value;

            const date1 = new Date(d1);
            const date2 = new Date(d2);
            const time = Math.abs(date2 - date1);
            const days = Math.ceil(time / (1000 * 60 * 60 * 24));
            console.log(days);

            if (date1 > date2) {
                document.getElementById('eventtiming').innerHTML = "";
                alert("Please make valid selection of starting and ending dates")
            }
            else {
                if (counter > 1) {
                    document.getElementById('eventtiming').innerHTML = "";
                }

                for (var i = 1; i <= days + 1; i++) {
                    html = '<label for="eventtime" class="col-md-4 col-form-label fieldspace"><strong>Day ' + i + ' Time</strong><span class="required"> *</span></label>\
                            <div class="col-md-4 fieldspace" style="padding-right: 1rem;">\
                                <label for="starttime'+ i + '" class="col-sm-6 col-form-label"><strong>Start Time :</strong></label>\
                                <input type="time" class="form-control" id="starttime'+ i + '" min="09:00" max="16:00"></input>\
                            </div>\
                            <div class="col-md-4 fieldspace" style="padding-left: 1rem;">\
                                <label for="endtime'+ i + '" class="col-sm-6 col-form-label"><strong>End Time :</strong></label>\
                                <input type="time" class="form-control" id="endtime'+ i + '" min="09:00" max="16:00"></input>\
                            </div>'
                    document.getElementById('eventtiming').innerHTML += html;
                }
            }

            let timeSelect1 = document.querySelector("#starttime1").min = new Date().toLocaleTimeString();
            let timeSelect2 = document.querySelector("#endtime1").min = new Date().toLocaleTimeString();
            // console.log(timeSelect1.min);
            // timeSelect1.value = new Date().toLocaleTimeString();
            // timeSelect2.value = new Date().toLocaleTimeString();
        }

        function addTabs() {
            count++;

            if (count < 5) {
                html = '<div id="tab' + count + '" class="tab"  onclick="showTab(this.id)">\
                    <h4>New Announcement</h4>\
                    <div id="close_tab' + count + '" class="close_tab"  onclick="closeTabs(this.id)">\
                        <img src="close.png" alt="" class="close">\
                    </div>\
                </div>';

                form = '<form class="form" name="form' + count + '" method="post" id="form' + count + '">\
                    <div class="form-group row ">\
                        <label for ="academicyear' + count + '" class="col-sm-4 col-form-label fieldspace"><strong>Academic Year</strong><span class="required"> *</span></label>\
                        <div class="col-sm-5 fieldspace">\
                            <select class="form-control" id="academicyear'+ count + '" name="academicyear' + count + '">\
                                <option value="2021-2022">2021-2022</option>\
                                <option value="2022-2023">2022-2023</option>\
                                <option value="2023-2024">2023-2024</option>\
                                <option value="2024-2025">2024-2025</option>\
                                <option value="2025-2026">2025-2026</option>\
                                <option value="2026-2027">2026-2027</option>\
                                <option value="2027-2028">2027-2028</option>\
                                <option value="2028-2029">2028-2029</option>\
                                <option value="2029-2030">2029-2030</option>\
                            </select>\
                        </div>\
                        <label for="eventname' + count + '" class="col-sm-4 col-form-label fieldspace"><strong>Event Name</strong><span class="required"> *</span></label>\
                        <div class="col-sm-8 fieldspace">\
                            <textarea class="form-control" id="eventname' + count + '" name="eventname' + count + '" rows="3"></textarea>\
                        </div>\
                        <label for="eventfocus' + count + '" class="col-sm-4 col-form-label fieldspace"><strong>Event Focus</strong><span class="required"> *</span></label>\
                        <div class="col-sm-8 fieldspace">\
                            <textarea class="form-control" id="eventfocus' + count + '" name="eventfocus' + count + '" rows="3"></textarea>\
                        </div>\
                        <label for="eventstartdate' + count + '" class="col-sm-4 col-form-label fieldspace"><strong>Event Start Date</strong><span class="required"> *</span></label>\
                        <div class="col-sm-5 fieldspace">\
                            <input type="date" class="form-control" id="eventstartdate' + count + '" name="eventstartdate' + count + '" onchange="calculateDays()"></div>\
                        <label for="eventenddate' + count + '" class="col-sm-4 col-form-label fieldspace"><strong>Event End Date</strong><span class="required"> *</span></label>\
                        <div class="col-sm-5 fieldspace">\
                            <input type="date" class="form-control" id="eventenddate' + count + '" name="eventenddate' + count + '" onchange="calculateDays()">\
                        </div>\
                        <div class="form-group row" id="eventtiming' + count + '"></div>\
                        <label for="eventvenue' + count + '" class="col-sm-4 col-form-label fieldspace"><strong>Event Venue</strong><span class="required"> *</span></label>\
                        <div class="col-sm-8 fieldspace">\
                            <textarea class="form-control" id="eventvenue' + count + '" name="eventvenue' + count + '" rows="3"></textarea>\
                        </div>\
                        <label for="eventresourceperson' + count + '" class="col-sm-4 col-form-label fieldspace"><strong>Event Resource Person</strong><span class="required"> *</span></label>\
                        <div class="col-sm-8 fieldspace">\
                            <textarea class="form-control" id="eventresourceperson' + count + '" name="eventresourceperson' + count + '" rows="3"></textarea>\
                        </div>\
                        <div class="container">\
                            <div class="col-md-12 text-center">\
                                <button type="button" class="btn btn-outline-dark fieldspace" id="submit' + count + '" name="submit' + count + '">Announce</button>\
                            </div>\
                        </div>\
                    </div>\
                </form>';

                document.getElementById('all_tab').innerHTML += html;
                document.getElementById('announcement_section').innerHTML += form;

                var allTab = document.getElementById('all_tab').children;

                var tempChild = allTab[count].id;
                var tempForm = childs_announcement[count].id;
                tabList[tempChild] = tempForm;
                tabHistory[tempChild] = tempForm;

                for (var child in childs_announcement) {
                    if (childs_announcement[child].id === tabList[tempChild]) {
                        document.getElementById(childs_announcement[child].id).style.display = 'block'; // to show only the newly created tab
                        tabHistory[tempChild] = tempForm; // to store the history of tabs
                    }
                    else if (child !== 'length' && child !== 'item' && child !== 'namedItem') {
                        document.getElementById(childs_announcement[child].id).style.display = 'none';
                    }
                }

                // change of tab color when clicking on it..
                for (var tabs in tabList) {
                    if (tabs === tempChild) {
                        document.getElementById(tabs).style.backgroundColor = "#00000033";
                        document.getElementById(tabs).style.color = "#000000";
                    }
                    else {
                        document.getElementById(tabs).style.backgroundColor = "#000000";
                        document.getElementById(tabs).style.color = "#ffffff";
                    }
                }

                // document.getElementById(tempChild).style.backgroundColor = "#00000033";
                // document.getElementById(tempChild).style.color = "#000000";

                if (count == 4) {
                    document.getElementById('plusbtn').style.display = 'none';
                }
            }
        }

        function closeTabs(child_id) {
            if (count < 1) {
                return;
            }

            var announcement = document.getElementById('announcement_section'); // to store the announcement section as a variable
            var childTab = document.getElementById(child_id);

            // console.log(childTab.parentElement.id);
            var parentID = childTab.parentElement.id; // to get the tab id to close it

            for (var child in childs_announcement) {
                if (childs_announcement[child].id === tabList[parentID]) {
                    announcement.removeChild(childs_announcement[child]);
                    console.log("deleted");
                }
            }

            delete tabHistory[parentID];
            childTab.parentElement.remove();
            delete tabList[parentID];
            count--;

            var lastTab = Object.keys(tabHistory).pop(); // fetching the last tab from tabHistory

            for (var forms in childs_announcement) {
                if (childs_announcement[forms].id === tabList[lastTab]) {
                    document.getElementById(childs_announcement[forms].id).style.display = 'block';
                }
            }

            // lund code, bhenchod not executable
            for (var tabs in tabList) {
                if (tabs === lastTab) {
                    document.getElementById(tabs).style.backgroundColor = "#00000033";
                    document.getElementById(tabs).style.color = "#000000";
                }
                else {
                    document.getElementById(tabs).style.backgroundColor = "#000000";
                    document.getElementById(tabs).style.color = "#ffffff";
                }
            }

            if (count < 5) {
                document.getElementById('plusbtn').style.display = 'flex';
            }
        }

        // to show the requested tab
        function showTab(tabID) {
            if (tabList[tabID]) {
                for (var child in childs_announcement) {
                    if (childs_announcement[child].id === tabList[tabID]) {
                        document.getElementById(childs_announcement[child].id).style.display = 'block';
                        tabHistory[tabID] = childs_announcement[child].id;
                    }
                    else if (child !== 'length' && child !== 'item' && child !== 'namedItem') {
                        document.getElementById(childs_announcement[child].id).style.display = 'none';
                    }
                }
            }

            for (var tabs in tabList) {
                if (tabs === tabID) {
                    document.getElementById(tabID).style.backgroundColor = "#00000033";
                    document.getElementById(tabID).style.color = "#000000";
                }
                else {
                    document.getElementById(tabs).style.backgroundColor = "#000000";
                    document.getElementById(tabs).style.color = "#ffffff";
                }
            }

            var logsData = choose_tab[tabID];

            console.log(tabID);
            for (var metadata in logsData) {
                if (localStorage.getItem(logsData[metadata])) {
                    document.getElementById(logsData[metadata]).value = localStorage.getItem(logsData[metadata]);
                }
            }
        }

        // to save the values in localStorage
        function savevalue(id) {
            console.log(id);
            localStorage.setItem(id, document.getElementById(id).value);
            console.log(localStorage.getItem(id));
        }

        function getKeyByValue(object, value) {
            return Object.keys(object).find(key => object[key] === value);
        }

        const patterns = {
            eventname: /^[a-zA-z .]+$/
        };

        const inputs = document.querySelectorAll('textarea');

        inputs.forEach((validator) => {
            validator.addEventListener('keyup', (e) => {
                // console.log(e.target.attributes.name.value);
                validate(e.target, patterns[e.target.attributes.name.value]);
            })
            console.log(validator);
        })

        function validate(field, regex) {
            // var inputs = document.querySelectorAll('input');
            // console.log(inputs);
            // var isTab = getKeyByValue(tabList, id)
            // var en="/^[^. 0-9\?][a-zA-z .]+[0-9. ]*?[^. ]$/gm";

            // var inputPattern = /^\d*[a-zA-Z]{1,}\d*/;
            // input.oninvalid = function (event) {
            //     event.target.setCustomValidity('Only numbers are not allowed !');
            //     alert('Only numbers are not allowed !');
            // }

            console.log(regex.test(field.value));

            // if (patterns[id].test(id.value)) {
            //     alert('ok');
            //     return true;
            // }
            // else {
            //     alert('not ok');
            //     // input.setCustomValidity('not ok');
            //     return false;
            // }
            // alert('Eventname is taken');

            savevalue(field.id);
        }
    </script>
</body>

</html>